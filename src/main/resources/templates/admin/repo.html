<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Reportes Generales</title>
    <!-- Incluye tus CSS/JS como en dashboardAdmi -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div th:replace="~{fragmentsAdmi :: header}"></div>
    <div class="container-fluid py-3" style="max-width: 1400px;">
        <div class="row mx-0 justify-content-center">
            <div class="col-12 px-0 mb-4">
                <h2 class="c-primary fw-bold">Reportes Generales</h2>
                <p class="text-muted">Vista consolidada de todos los reportes. Filtros aplicados: Desde <span th:text="${fechaInicio}"></span> Hasta <span th:text="${fechaFin}"></span></p>
                <!-- Formulario para filtros -->
                <form method="get" class="mb-3">
                    <div class="row">
                        <div class="col-md-3">
                            <label>Fecha Inicio:</label>
                            <input type="date" name="fechaInicio" th:value="${fechaInicio}" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label>Fecha Fin:</label>
                            <input type="date" name="fechaFin" th:value="${fechaFin}" class="form-control">
                        </div>
                        <div class="col-md-3">
                            <label>Rango Rápido:</label>
                            <select name="rango" class="form-control">
                                <option value="">Personalizado</option>
                                <option value="semanal">Semanal</option>
                                <option value="quincenal">Quincenal</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <button type="submit" class="btn btn-primary mt-4">Filtrar</button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Pestañas -->
            <div class="col-12">
                <ul class="nav nav-tabs" id="reportesTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="stock-tab" data-bs-toggle="tab" data-bs-target="#stock" type="button" role="tab">Stock Crítico</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="kardex-tab" data-bs-toggle="tab" data-bs-target="#kardex" type="button" role="tab">Kardex PEPS</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="rentabilidad-tab" data-bs-toggle="tab" data-bs-target="#rentabilidad" type="button" role="tab">Rentabilidad</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="mermas-tab" data-bs-toggle="tab" data-bs-target="#mermas" type="button" role="tab">Mermas</button>
                    </li>
                </ul>
                <div class="tab-content" id="reportesTabContent">
                    <!-- Pestaña Stock Crítico -->
                    <div class="tab-pane fade show active" id="stock" role="tabpanel">
                        <div class="table-container mt-3">
                            <h5>Reporte de Inventario y Stock Crítico</h5>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Nombre Insumo</th>
                                        <th>Stock Actual</th>
                                        <th>Stock Mínimo</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${reporteStockCritico}">
                                        <td th:text="${item.nombre_insumo}"></td>
                                        <td th:text="${item.stock_actual}"></td>
                                        <td th:text="${item.stock_minimo}"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Pestaña Kardex -->
                    <div class="tab-pane fade" id="kardex" role="tabpanel">
                        <div class="table-container mt-3">
                            <h5>Reporte de Kardex y Costo de Inventario (PEPS)</h5>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Lote</th>
                                        <th>Insumo</th>
                                        <th>Fecha Entrada</th>
                                        <th>Fecha Vencimiento</th>
                                        <th>Costo Unitario</th>
                                        <th>Cantidad Inicial</th>
                                        <th>Cantidad Usada</th>
                                        <th>Cantidad Disponible</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${reporteKardex}">
                                        <td th:text="${item.lote_id}"></td>
                                        <td th:text="${item.insumo}"></td>
                                        <td th:text="${item.fecha_entrada}"></td>
                                        <td th:text="${item.fecha_vencimiento}"></td>
                                        <td th:text="${item.costo_unitario}"></td>
                                        <td th:text="${item.cantidad_inicial}"></td>
                                        <td th:text="${item.cantidad_usada}"></td>
                                        <td th:text="${item.cantidad_disponible}"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Pestaña Rentabilidad -->
                    <div class="tab-pane fade" id="rentabilidad" role="tabpanel">
                        <div class="table-container mt-3">
                            <h5>Reporte de Rentabilidad por Producto</h5>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th>Precio Venta</th>
                                        <th>Costo Producción Unitario</th>
                                        <th>Margen Bruto Unitario</th>
                                        <th>Margen Bruto Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${reporteRentabilidad}">
                                        <td th:text="${item.producto}"></td>
                                        <td th:text="${item.precio_venta}"></td>
                                        <td th:text="${item.costo_produccion_unitario}"></td>
                                        <td th:text="${item.margen_bruto_unitario}"></td>
                                        <td th:text="${item.margen_bruto_total}"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Pestaña Mermas -->
                    <div class="tab-pane fade" id="mermas" role="tabpanel">
                        <div class="table-container mt-3">
                            <h5>Reporte de Mermas Detallado</h5>
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Producto/Insumo</th>
                                        <th>Cantidad</th>
                                        <th>Fecha</th>
                                        <th>Motivo</th>
                                        <th>Empleado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="item : ${reporteMermas}">
                                        <td th:text="${item.producto_insumo}"></td>
                                        <td th:text="${item.cantidad}"></td>
                                        <td th:text="${item.fecha}"></td>
                                        <td th:text="${item.motivo}"></td>
                                        <td th:text="${item.empleado}"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div th:replace="~{fragmentsAdmi :: menuLateral}"></div>
</body>
</html>